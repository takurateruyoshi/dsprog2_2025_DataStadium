<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ストライクゾーン分析</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 1400px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .selection-section h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
        }

        /* 投手選択 */
        .hand-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .hand-button {
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: bold;
            color: #667eea;
        }

        .hand-button:hover, .hand-button.selected {
            background: #667eea;
            color: white;
        }

        /* 球種選択 */
        .pitch-selector {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            max-height: 500px;
            overflow-y: auto;
        }

        .pitch-button {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: bold;
            color: #667eea;
            text-align: left;
        }

        .pitch-button:hover, .pitch-button.selected {
            background: #667eea;
            color: white;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ヒートマップ */
        .heatmap-container h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .zone-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 3px;
            background: #333;
            padding: 3px;
            border-radius: 12px;
            aspect-ratio: 1;
            max-width: 100%;
        }

        .zone-cell {
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 80px;
        }

        .zone-cell:hover, .zone-cell.selected {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
        }

        .zone-cell .rate {
            font-size: 20px;
            font-weight: bold;
        }

        .zone-cell .label {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }

        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 25px;
            height: 15px;
            border-radius: 3px;
        }

        /* 球速別グラフ */
        .chart-container {
            margin-top: 30px;
        }

        .chart-header {
            margin-bottom: 15px;
        }

        .chart-header h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .chart-header .zone-info {
            color: #667eea;
            font-size: 14px;
            font-weight: bold;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 250px;
            border-left: 2px solid #333;
            border-bottom: 2px solid #333;
            padding: 20px;
            position: relative;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 80px;
        }

        .bar {
            width: 100%;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
            position: relative;
            min-height: 5px;
        }

        .bar:hover {
            opacity: 0.8;
            transform: scaleY(1.02);
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: #333;
            font-size: 13px;
        }

        .bar-label {
            margin-top: 8px;
            font-size: 11px;
            color: #666;
            text-align: center;
        }

        /* 見逃し・空振り円グラフ */
        .pie-chart-container {
            margin-top: 30px;
        }

        .pie-chart-header {
            margin-bottom: 15px;
        }

        .pie-chart-header h3 {
            color: #333;
            font-size: 18px;
            font-weight: bold;
        }

        .pie-chart-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .pie-chart {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .pie-legend {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .pie-legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pie-legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .pie-legend-label {
            font-size: 14px;
            color: #333;
        }

        .pie-legend-value {
            font-weight: bold;
            color: #667eea;
            margin-left: auto;
        }

        .current-selection {
            text-align: center;
            color: #666;
            margin-bottom: 10px;
            font-size: 13px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        .current-selection strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚾ ストライクゾーン分析ツール</h1>
        
        <div class="current-selection" id="currentSelection">
            投手: <strong id="selectedHand">未選択</strong> | 
            球種: <strong id="selectedPitchDisplay">未選択</strong> | 
            コース: <strong id="selectedZoneDisplay">未選択</strong>
        </div>

        <div class="main-layout">
            <!-- 左パネル: 選択UI -->
            <div class="left-panel">
                <!-- 投手選択 -->
                <div>
                    <h3>投手</h3>
                    <div class="hand-selector" id="handSelector"></div>
                </div>

                <!-- 球種選択 -->
                <div>
                    <h3>球種</h3>
                    <div class="pitch-selector" id="pitchSelector"></div>
                </div>
            </div>

            <!-- 右パネル: データ表示 -->
            <div class="right-panel">
                <!-- ヒートマップ -->
                <div>
                    <h3>コース別被打率</h3>
                    <div class="zone-grid" id="zoneGrid"></div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ff4444;"></div>
                            <span>高(0.400~)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ffaa44;"></div>
                            <span>中(0.250~)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #44ff44;"></div>
                            <span>低(~0.249)</span>
                        </div>
                    </div>
                </div>

                <!-- 球速別グラフ -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>球速別打数分布</h3>
                        <div class="zone-info" id="zoneInfo">コースを選択してください</div>
                    </div>
                    <div class="bar-chart" id="barChart">
                        <p style="text-align: center; color: #999; margin: auto;">コースを選択すると球速別データが表示されます</p>
                    </div>
                </div>

                <!-- 見逃し・空振り円グラフ -->
                <div class="pie-chart-container">
                    <div class="pie-chart-header">
                        <h3>見逃し・空振り比率</h3>
                    </div>
                    <div class="pie-chart-content" id="pieChartContent">
                        <p style="text-align: center; color: #999; margin: auto;">コースを選択すると見逃し・空振り比率が表示されます</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // データ設定エリア - ここに分析結果を渡す
        // ============================================
        
        const analysisData = {
            // 球種リスト
            pitchTypes: [
                'ストレート', 'スライダー', 'カーブ', 'フォーク', 'カットボール', 
                'チェンジアップ', 'スプリット', 'ワンシーム', 'ツーシーム', '縦スライダー',
                'シュート', 'ナックルカーブ', 'パワーカーブ', 'スローカーブ', 'シンカー',
                'パーム', '高速スライダー', 'スクリュー', 'スラーブ', 'スローボール', 'ナックル'
            ],
            
            // デフォルトデータ生成関数
            generateDefaultData: function() {
                const defaultData = {};
                
                this.pitchTypes.forEach(pitchType => {
                    // 各球種のデフォルト被打率を生成（中心ほど高く、端ほど低い傾向）
                    const battingAverage = [];
                    for (let row = 0; row < 5; row++) {
                        battingAverage[row] = [];
                        for (let col = 0; col < 5; col++) {
                            // 中心(2,2)からの距離で被打率を決定
                            const centerDistance = Math.abs(row - 2) + Math.abs(col - 2);
                            const baseRate = 0.400 - (centerDistance * 0.040);
                            const randomVariation = (Math.random() - 0.5) * 0.050;
                            battingAverage[row][col] = Math.max(0.100, Math.min(0.450, baseRate + randomVariation));
                        }
                    }
                    
                    // 球速帯を球種ごとに設定
                    let speedRanges;
                    if (['ストレート', 'ツーシーム', 'ワンシーム', 'カットボール'].includes(pitchType)) {
                        speedRanges = ['130-139', '140-149', '150-159', '160+'];
                    } else if (['高速スライダー', 'スプリット'].includes(pitchType)) {
                        speedRanges = ['130-139', '140-149', '150-159'];
                    } else if (['スライダー', 'シュート', '縦スライダー', 'シンカー'].includes(pitchType)) {
                        speedRanges = ['120-129', '130-139', '140-149'];
                    } else if (['フォーク', 'チェンジアップ', 'パーム'].includes(pitchType)) {
                        speedRanges = ['120-129', '130-139', '140-149'];
                    } else if (['スローカーブ', 'スローボール', 'ナックル'].includes(pitchType)) {
                        speedRanges = ['90-99', '100-109', '110-119'];
                    } else {
                        speedRanges = ['100-109', '110-119', '120-129', '130-139'];
                    }
                    
                    // 25ゾーンの球速別データを生成
                    const velocityData = [];
                    for (let i = 0; i < 25; i++) {
                        const hits = speedRanges.map(() => Math.floor(Math.random() * 15) + 3);
                        
                        // 見逃し・空振り比率を生成
                        const lookingRate = Math.random() * 0.6 + 0.2; // 20-80%
                        const swingingRate = 1 - lookingRate;
                        
                        velocityData.push({
                            speeds: speedRanges,
                            hits: hits,
                            looking: Math.round(lookingRate * 100), // パーセント
                            swinging: Math.round(swingingRate * 100)
                        });
                    }
                    
                    defaultData[pitchType] = {
                        battingAverage: battingAverage,
                        velocityData: velocityData
                    };
                });
                
                return defaultData;
            },
            
            // データを初期化
            data: null
        };
        
        // データを生成
        analysisData.data = analysisData.generateDefaultData();

        // ============================================
        // アプリケーションロジック
        // ============================================

        let selectedHand = null;
        let selectedPitch = null;
        let selectedZone = null;
        let selectedZoneName = '';

        // 初期化
        function init() {
            renderHandSelector();
            renderPitchSelector();
            renderHeatmap();
        }

        // 投手選択UI
        function renderHandSelector() {
            const container = document.getElementById('handSelector');
            container.innerHTML = '';
            
            const hands = ['右投げ', '左投げ'];
            hands.forEach(hand => {
                const button = document.createElement('button');
                button.className = 'hand-button';
                button.textContent = hand;
                button.onclick = () => selectHand(hand, button);
                container.appendChild(button);
            });
        }

        function selectHand(hand, buttonElement) {
            selectedHand = hand;
            document.getElementById('selectedHand').textContent = hand;
            
            // 選択状態を視覚化
            document.querySelectorAll('.hand-button').forEach(btn => btn.classList.remove('selected'));
            buttonElement.classList.add('selected');
            
            // ヒートマップを更新
            if (selectedPitch) {
                renderHeatmap();
            }
        }

        // 球種選択UI
        function renderPitchSelector() {
            const container = document.getElementById('pitchSelector');
            container.innerHTML = '';
            
            analysisData.pitchTypes.forEach(pitch => {
                const button = document.createElement('button');
                button.className = 'pitch-button';
                button.textContent = pitch;
                button.onclick = () => selectPitch(pitch, button);
                container.appendChild(button);
            });
        }

        function selectPitch(pitch, buttonElement) {
            selectedPitch = pitch;
            document.getElementById('selectedPitchDisplay').textContent = pitch;
            
            // 選択状態を視覚化
            document.querySelectorAll('.pitch-button').forEach(btn => btn.classList.remove('selected'));
            buttonElement.classList.add('selected');
            
            // ゾーン選択をリセット
            selectedZone = null;
            selectedZoneName = '';
            document.getElementById('selectedZoneDisplay').textContent = '未選択';
            
            renderHeatmap();
            clearBarChart();
        }

        // ヒートマップ描画
        function renderHeatmap() {
            const container = document.getElementById('zoneGrid');
            container.innerHTML = '';
            
            if (!selectedPitch) {
                container.innerHTML = '<p style="text-align: center; color: #999; grid-column: 1/-1;">球種を選択してください</p>';
                return;
            }
            
            const data = analysisData.data[selectedPitch];
            if (!data || !data.battingAverage) {
                container.innerHTML = '<p style="text-align: center; color: #999; grid-column: 1/-1;">データがありません</p>';
                return;
            }
            
            const zoneLabels = ['高外', '高中外', '高中', '高中内', '高内',
                              '外', '中外', '真ん中', '中内', '内',
                              '低外', '低中外', '低中', '低中内', '低内',
                              '低外低', '低中外低', '低中低', '低中内低', '低内低',
                              '外低', '中外低', '中低', '中内低', '内低'];
            
            let index = 0;
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'zone-cell';
                    
                    const avg = data.battingAverage[row][col];
                    const color = getColorForAverage(avg);
                    cell.style.background = color;
                    
                    const rate = document.createElement('div');
                    rate.className = 'rate';
                    rate.textContent = avg.toFixed(3);
                    rate.style.color = avg > 0.3 ? 'white' : '#333';
                    
                    const label = document.createElement('div');
                    label.className = 'label';
                    label.textContent = zoneLabels[index];
                    label.style.color = avg > 0.3 ? 'rgba(255,255,255,0.8)' : '#666';
                    
                    cell.appendChild(rate);
                    cell.appendChild(label);
                    
                    const currentIndex = index;
                    const currentLabel = zoneLabels[index];
                    cell.onclick = () => selectZone(currentIndex, currentLabel, cell);
                    
                    container.appendChild(cell);
                    index++;
                }
            }
        }

        function getColorForAverage(avg) {
            if (avg >= 0.400) return '#ff4444';
            if (avg >= 0.350) return '#ff6644';
            if (avg >= 0.300) return '#ff8844';
            if (avg >= 0.250) return '#ffaa44';
            if (avg >= 0.200) return '#88ff44';
            return '#44ff44';
        }

        function selectZone(zoneIndex, zoneName, cellElement) {
            if (!selectedPitch) {
                alert('先に球種を選択してください');
                return;
            }
            
            selectedZone = zoneIndex;
            selectedZoneName = zoneName;
            document.getElementById('selectedZoneDisplay').textContent = zoneName;
            document.getElementById('zoneInfo').textContent = `${selectedPitch} - ${zoneName}コース`;
            
            // 選択状態を視覚化
            document.querySelectorAll('.zone-cell').forEach(cell => cell.classList.remove('selected'));
            cellElement.classList.add('selected');
            
            renderBarChart();
            renderPieChart();
        }

        // 球速別グラフ描画
        function renderBarChart() {
            const container = document.getElementById('barChart');
            container.innerHTML = '';
            
            const pitchData = analysisData.data[selectedPitch];
            if (!pitchData || !pitchData.velocityData || !pitchData.velocityData[selectedZone]) {
                container.innerHTML = '<p style="text-align: center; color: #999; margin: auto;">データがありません</p>';
                return;
            }
            
            const velocityData = pitchData.velocityData[selectedZone];
            if (!velocityData.hits || velocityData.hits.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; margin: auto;">打数データがありません</p>';
                return;
            }
            
            const maxHits = Math.max(...velocityData.hits);
            
            velocityData.speeds.forEach((speed, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'bar-wrapper';
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                const height = maxHits > 0 ? (velocityData.hits[index] / maxHits) * 200 : 5;
                bar.style.height = height + 'px';
                
                const value = document.createElement('div');
                value.className = 'bar-value';
                value.textContent = velocityData.hits[index] + '回';
                bar.appendChild(value);
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = speed + '\nkm/h';
                label.style.whiteSpace = 'pre';
                
                wrapper.appendChild(bar);
                wrapper.appendChild(label);
                container.appendChild(wrapper);
            });
        }

        function clearBarChart() {
            const container = document.getElementById('barChart');
            container.innerHTML = '<p style="text-align: center; color: #999; margin: auto;">コースを選択すると球速別データが表示されます</p>';
            document.getElementById('zoneInfo').textContent = 'コースを選択してください';
            clearPieChart();
        }

        // 円グラフ描画
        function renderPieChart() {
            const container = document.getElementById('pieChartContent');
            container.innerHTML = '';
            
            const pitchData = analysisData.data[selectedPitch];
            if (!pitchData || !pitchData.velocityData || !pitchData.velocityData[selectedZone]) {
                container.innerHTML = '<p style="text-align: center; color: #999; margin: auto;">データがありません</p>';
                return;
            }
            
            const zoneData = pitchData.velocityData[selectedZone];
            const lookingPercent = zoneData.looking;
            const swingingPercent = zoneData.swinging;
            
            // SVG円グラフを作成
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '200');
            svg.setAttribute('height', '200');
            svg.setAttribute('viewBox', '0 0 200 200');
            svg.classList.add('pie-chart');
            
            // 円グラフの描画
            const centerX = 100;
            const centerY = 100;
            const radius = 80;
            
            // 見逃しの扇形
            const lookingAngle = (lookingPercent / 100) * 360;
            const lookingPath = createPieSlice(centerX, centerY, radius, 0, lookingAngle);
            lookingPath.setAttribute('fill', '#4CAF50');
            lookingPath.setAttribute('stroke', 'white');
            lookingPath.setAttribute('stroke-width', '2');
            svg.appendChild(lookingPath);
            
            // 空振りの扇形
            const swingingPath = createPieSlice(centerX, centerY, radius, lookingAngle, 360);
            swingingPath.setAttribute('fill', '#FF9800');
            swingingPath.setAttribute('stroke', 'white');
            swingingPath.setAttribute('stroke-width', '2');
            svg.appendChild(swingingPath);
            
            // 中心の白い円（ドーナツ型にする）
            const innerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            innerCircle.setAttribute('cx', centerX);
            innerCircle.setAttribute('cy', centerY);
            innerCircle.setAttribute('r', radius * 0.5);
            innerCircle.setAttribute('fill', 'white');
            svg.appendChild(innerCircle);
            
            // 凡例を作成
            const legend = document.createElement('div');
            legend.className = 'pie-legend';
            
            // 見逃し
            const lookingItem = document.createElement('div');
            lookingItem.className = 'pie-legend-item';
            lookingItem.innerHTML = `
                <div class="pie-legend-color" style="background: #4CAF50;"></div>
                <span class="pie-legend-label">見逃し</span>
                <span class="pie-legend-value">${lookingPercent}%</span>
            `;
            legend.appendChild(lookingItem);
            
            // 空振り
            const swingingItem = document.createElement('div');
            swingingItem.className = 'pie-legend-item';
            swingingItem.innerHTML = `
                <div class="pie-legend-color" style="background: #FF9800;"></div>
                <span class="pie-legend-label">空振り</span>
                <span class="pie-legend-value">${swingingPercent}%</span>
            `;
            legend.appendChild(swingingItem);
            
            container.appendChild(svg);
            container.appendChild(legend);
        }

        // 円グラフの扇形を作成するヘルパー関数
        function createPieSlice(cx, cy, r, startAngle, endAngle) {
            const start = polarToCartesian(cx, cy, r, endAngle);
            const end = polarToCartesian(cx, cy, r, startAngle);
            const largeArcFlag = endAngle - startAngle <= 180 ? '0' : '1';
            
            const d = [
                'M', cx, cy,
                'L', start.x, start.y,
                'A', r, r, 0, largeArcFlag, 0, end.x, end.y,
                'Z'
            ].join(' ');
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', d);
            return path;
        }

        function polarToCartesian(cx, cy, r, angleInDegrees) {
            const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
            return {
                x: cx + (r * Math.cos(angleInRadians)),
                y: cy + (r * Math.sin(angleInRadians))
            };
        }

        function clearPieChart() {
            const container = document.getElementById('pieChartContent');
            container.innerHTML = '<p style="text-align: center; color: #999; margin: auto;">コースを選択すると見逃し・空振り比率が表示されます</p>';
        }

        // 初期化実行
        init();
    </script>
</body>
</html>
